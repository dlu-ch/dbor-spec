% SPDX-License-Identifier: CC-BY-4.0
% DBOR specification - Dense Binary Object Representation
% Copyright (C) 2020 Daniel Lutz <dlu-ch@users.noreply.github.com>

\documentclass{dbor-article}
    \pdfsuppresswarningpagegroup=1
    \overfullrule 5pt

    % mathematical symbols and operators
    \newcommand{\e}{\mathrm{e}}
    \DeclareMathOperator{\BitAnd}{AND}
    \DeclareMathOperator{\BitOr}{OR}
    \newcommand{\SetOfReals}{\mathbbm{R}}
    \newcommand{\SetOfIntegers}{\mathbbm{Z}}
    \newcommand{\BinNumber}[1]{\mathrm{#1}_{2}}
    \newcommand{\HexNumber}[1]{\mathrm{#1}_{16}}
    \newcommand{\IntegerInterval}[2]{\{#1 \,\ldots\, #2\}}

    % TODO use \pdfstringdefDisableCommands
    % https://tex.stackexchange.com/questions/430876/ways-to-avoid-package-hyperref-warning-token-not-allowed-in-a-pdf-string-warn?answertab=active#tab-top

    \newcommand{\Concat}{\ensuremath{\lrtimes}}
    \newcommand{\ByteSequence}[1]{%
        \texorpdfstring{% allow use in \section{...} etc.
            \ensuremath{\langle #1 \rangle}%
        }{%
            <#1>%
        }%
    }

    \makeatletter
    \DeclareRobustCommand{\DborSyntaxIdent}[2]{%
        \texorpdfstring{% allow use in \section{...} etc.
            \@ifstar{%
                \hyperlink{sec:def:#1}{\texttt{#2}}%
            }{%
                \texttt{#2}%
            }%
        }{%
            \texttt{#2}%
        }%
    }
    \makeatother

    \newcommand{\DborValue}{\DborSyntaxIdent{Value}{Value}}
    \newcommand{\DborElementaryValue}{\DborSyntaxIdent{ElementaryValue}{Elementary\-Value}}
    \newcommand{\DborNumberValue}{\DborSyntaxIdent{NumberValue}{Number\-Value}}
    \newcommand{\DborStringValue}{\DborSyntaxIdent{StringValue}{String\-Value}}
    \newcommand{\DborContainerValue}{\DborSyntaxIdent{ContainerValue}{Container\-Value}}

    \newcommand{\DborNoneValue}{\DborSyntaxIdent{NoneValue}{None\-Value}}
    \newcommand{\DborMinusZeroValue}{\DborSyntaxIdent{MinusZeroValue}{Minus\-Zero\-Value}}
    \newcommand{\DborInfinityValue}{\DborSyntaxIdent{InfinityValue}{Infinity\-Value}}
    \newcommand{\DborMinusInfinityValue}{\DborSyntaxIdent{MinusInfinityValue}{Minus\-Infinity\-Value}}
    \newcommand{\DborIntegerValue}{\DborSyntaxIdent{Integer}{Integer\-Value}}
    \newcommand{\DborBinaryRationalValue}{\DborSyntaxIdent{BinaryRationalValue}{Binary\-Rational\-Value}}
    \newcommand{\DborDecimalRationalValue}{\DborSyntaxIdent{DecimalRationalValue}{Decimal\-Rational\-Value}}
    \newcommand{\DborByteStringValue}{\DborSyntaxIdent{ByteStringValue}{Byte\-String\-Value}}
    \newcommand{\DborUtfEightStringValue}{\DborSyntaxIdent{Utf8EightStringValue}{Utf8\-String\-Value}}
    \newcommand{\DborSequenceValue}{\DborSyntaxIdent{SequenceValue}{Sequence\-Value}}
    \newcommand{\DborDictionaryValue}{\DborSyntaxIdent{DictionaryValue}{Dictionary\-Value}}
    \newcommand{\DborAllocatedValue}{\DborSyntaxIdent{AllocatedValue}{Allocated\-Value}}

    \newcommand{\DborMinimalToken}{\DborSyntaxIdent{MinimalToken}{Minimal\-Token}}
    \newcommand{\DborNaturalToken}{\DborSyntaxIdent{NaturalToken}{Natural\-Token}}
    \newcommand{\DborBinaryRationalToken}{\DborSyntaxIdent{BinaryRationalToken}{Binary\-Rational\-Token}}
    \newcommand{\DborIntegerToken}{\DborSyntaxIdent{IntegerToken}{Integer\-Token}}
    \newcommand{\DborPowerOfTenToken}{\DborSyntaxIdent{PowerOfTenToken}{Power\-Of\-Ten\-Token}}

    % colour coding of bytes sequences
    \newcommand{\DborFirstByte}[2]{\textcolor{#1}{\ensuremath{\bm{\HexNumber{#2}}}}}
    \newcommand{\DborFirstByteNone}[1]{\DborFirstByte{red-std}{#1}}
    \newcommand{\DborFirstByteNumber}[1]{\DborFirstByte{black}{#1}}
        % IntegerValue, BinaryRationalValue, DecimalRationalValue, MinusZero, Infinity, MinusInfinity
    \newcommand{\DborFirstByteString}[1]{\DborFirstByte{green-std}{#1}}
        % ByteStringValue, Utf8StringValue
    \newcommand{\DborFirstByteSequence}[1]{\DborFirstByte{blue-std}{#1}}
    \newcommand{\DborFirstByteDictionary}[1]{\DborFirstByte{violet-std}{#1}}
    \newcommand{\DborFirstByteAllocated}[1]{\DborFirstByte{gray-std}{#1}}
    \newcommand{\DborNextByte}[1]{\ensuremath{\HexNumber{#1}}}
    \newcommand{\DborNextByteFill}[1]{\textcolor{gray-std}{\ensuremath{\HexNumber{#1}}}}

    \newenvironment{Note}{\medskip\bgroup\small\ignorespaces}{\par\egroup\smallskip}

    \newcommand{\IncludeImageInPlace}[2][0.8]{%
        \begin{quotation}%
            \noindent
            \includegraphics[scale=#1]{#2}%
        \end{quotation}%
    }

    \newenvironment{Indented}{%
        \begin{addmargin}[\mathindent]{\mathindent}% KOMA script
    }{%
        \end{addmargin}%
    }

    \newcommand{\DborVersion}{\input{repo_wd_version.tex}}
    \title{DBOR specification \DborVersion}
    \author{Daniel Lutz}

\begin{document}

    \maketitle
    \tableofcontents

    \input{dbor-introduction.tex}
    \input{dbor-values.tex}
    \input{dbor-tokens.tex}
    \input{dbor-behaviour.tex}

    \appendix
    \input{dbor-implementation.tex}

\end{document}
